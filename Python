import pdfplumber
import pandas as pd
import re

# Set path to your PDF
pdf_path = r"C:\path\to\your\file.pdf"  # <-- update this path

# Lists to collect extracted data
sections = []
what_do = []
why_do = []
execute_audit = []

# Open and read specified pages
with pdfplumber.open(pdf_path) as pdf:
    for page in pdf.pages[178:360]:  # Pages 179 to 360
        text = page.extract_text()
        if not text:
            continue

        # Merge lines to handle split headers and questions
        merged_text = ' '.join(text.splitlines())

        # Regex to extract sections and QA blocks
        matches = re.findall(
            r"(1(?:\.\d+)?\s+.*?ISA\s*\|\s*.*?)\s*"
            r"What do we do\?\s*(.*?)\s*"
            r"Why do we do this\?\s*(.*?)\s*"
            r"Execute the Audit\s*(.*?)(?=1(?:\.\d+)?\s+.*?ISA\s*\|\s*.*?|$)",
            merged_text
        )

        for match in matches:
            section, what, why, exec_audit = match
            sections.append(section.strip())
            what_do.append(what.strip())
            why_do.append(why.strip())
            execute_audit.append(exec_audit.strip())

# Create DataFrame
df = pd.DataFrame({
    "Section": sections,
    "What do we do?": what_do,
    "Why do we do this?": why_do,
    "Execute the Audit": execute_audit
})

# Export to Excel
df.to_excel("section_1_output.xlsx", index=False)

print("Exported successfully to section_1_output.xlsx")
