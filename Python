import pdfplumber

pdf_path = r"C:\path\to\your\file.pdf"
results = []

with pdfplumber.open(pdf_path) as pdf:
    page = pdf.pages[15]  # Page 16
    text = page.extract_text()

    if not text:
        print("No text found.")
    else:
        lines = text.splitlines()
        i = 0

        while i < len(lines):
            line = lines[i].strip()
            section = None

            # Check if current line is a section header
            if line and line[0].isdigit() and "[ISA |" in line:
                section = line

            # Check if section header is split across two lines
            if (
                not section
                and line
                and line[0].isdigit()
                and i + 1 < len(lines)
                and "[ISA |" in lines[i + 1]
            ):
                section = line + " " + lines[i + 1].strip()
                i += 1  # Skip ISA line

            if not section:
                i += 1
                continue

            # Look for Q&A block
            what, why, execute = "", "", ""
            i += 1

            if i < len(lines) and lines[i].strip() == "What do we do?":
                i += 1
                while i < len(lines) and not lines[i].strip().startswith("Why do we do this"):
                    what += " " + lines[i].strip()
                    i += 1

                if i < len(lines) and lines[i].strip().startswith("Why do we do this"):
                    i += 1
                    while i < len(lines) and not lines[i].strip().startswith("Execute the Audit"):
                        why += " " + lines[i].strip()
                        i += 1

                    if i < len(lines) and lines[i].strip() == "Execute the Audit":
                        i += 1
                        while i < len(lines):
                            next_line = lines[i].strip()
                            if next_line and next_line[0].isdigit() and (
                                "[ISA |" in next_line
                                or (i + 1 < len(lines) and "[ISA |" in lines[i + 1])
                            ):
                                break
                            execute += " " + next_line
                            i += 1

                        results.append({
                            "Section": section.strip(),
                            "What do we do?": what.strip(),
                            "Why do we do this?": why.strip(),
                            "Execute the Audit": execute.strip()
                        })

            else:
                i += 1

# Print results
for idx, item in enumerate(results, 1):
    print(f"\nSection {idx}")
    for key, value in item.items():
        print(f"{key}: {value}")
