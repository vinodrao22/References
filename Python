import getpass
import win32com.client

def get_current_user():
    return getpass.getuser()

def get_ad_groups(username):
    groups = []
    try:
        obj = win32com.client.Dispatch("ADsNameSpaces")
        ldap = obj.GetObject("", "LDAP:")
        user = ldap.OpenDSObject("LDAP://%s" % username, "", "", 0)
        group_membership = user.GetEx("memberOf")
        for group in group_membership:
            groups.append(group)
    except Exception as e:
        print(f"Error: {e}")
    return groups

if __name__ == "__main__":
    username = get_current_user()
    print(f"Current user: {username}")
    print("Fetching AD groups...")
    groups = get_ad_groups(username)
    if groups:
        for group in groups:
            print(group)
    else:
        print("No AD groups found or unable to query Active Directory.")
