import fitz  # PyMuPDF
import re

pdf_path = "pdfextract.pdf"
doc = fitz.open(pdf_path)

# Load pages 15–30 (indexes 14–29)
text = ""
for page_number in range(14, min(30, len(doc))):
    text += doc[page_number].get_text() + "\n"

doc.close()

# Patterns
section_start_pattern = re.compile(r'^\d+(\.\d+)*\s')
isa_pattern = re.compile(r'ISA\s\|\s\d+')

# Process
lines = text.split('\n')
results = []

i = 0
while i < len(lines):
    line = lines[i].strip()
    if section_start_pattern.match(line):
        # Combine multi-line section header
        combined_line = line
        j = i + 1
        while j < len(lines):
            next_line = lines[j].strip()
            combined_line += ' ' + next_line
            if '[ISA' in next_line:
                break
            j += 1
        combined_line = combined_line.strip()

        # Check conditions
        if len(combined_line) < 150 and isa_pattern.search(combined_line):
            # Search for "What do we do?" section
            k = j + 1
            qna_answer = []
            while k < len(lines):
                current = lines[k].strip()
                if current.lower().startswith("why do we do this") or current.lower().startswith("execute the audit"):
                    break
                if current.lower() != "what do we do?":  # Skip the question itself
                    qna_answer.append(current)
                k += 1
            answer_text = ' '.join(qna_answer).strip()
            results.append({
                "section": combined_line,
                "what_do_we_do": answer_text
            })
        i = j
    else:
        i += 1

# Output
for item in results:
    print(f"{item['section']}\nWhat do we do? -> {item['what_do_we_do']}\n")
